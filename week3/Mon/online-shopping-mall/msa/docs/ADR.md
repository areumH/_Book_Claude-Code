# 아키텍처 결정 기록 (Architecture Decision Records)

## ADR-001: 주문/결제/배송 서비스 데이터베이스 선택 - PostgreSQL

### Status
Accepted (승인됨)

### Context
온라인 쇼핑몰의 주문, 결제, 배송, 사용자 인증 서비스를 위한 데이터베이스 선택이 필요합니다.

**주요 요구사항:**
- ACID 트랜잭션 지원 필수 (결제 처리의 데이터 일관성)
- 복잡한 관계형 데이터 모델 (사용자-주문-상품-결제 관계)
- 보고서 생성을 위한 복잡한 JOIN 쿼리
- 금융 데이터의 강력한 일관성 보장
- 동시성 제어 및 잠금 메커니즘

**고려된 대안:**
1. **PostgreSQL** - 관계형 데이터베이스
2. **MongoDB** - 문서형 NoSQL 데이터베이스
3. **MySQL** - 관계형 데이터베이스

### Decision
**PostgreSQL을 주문, 결제, 배송, 사용자 인증 서비스의 메인 데이터베이스로 선택합니다.**

**Y-Statement:**
"PostgreSQL을 선택함으로써, 우리는 강력한 ACID 트랜잭션 지원과 복잡한 관계형 쿼리 처리 능력을 확보하여 금융 데이터의 일관성을 보장하는 대신, NoSQL 대비 유연성과 수평적 확장의 복잡성을 감수하기로 결정했습니다."

### Alternatives Considered

#### PostgreSQL vs MongoDB 상세 비교

| 기준 | PostgreSQL | MongoDB |
|------|------------|---------|
| **트랜잭션** | 완전한 ACID 지원 | 4.0+ 제한적 ACID |
| **데이터 일관성** | 강력한 일관성 | 최종 일관성 |
| **쿼리 복잡성** | 복잡한 JOIN, 집계 우수 | 집계 파이프라인 |
| **스키마** | 고정 스키마, 마이그레이션 | 유연한 스키마 |
| **확장성** | 수직 확장 위주 | 수평 확장 우수 |
| **성능** | 복잡 쿼리 최적화 | 단순 읽기/쓰기 빠름 |
| **운영 복잡성** | 성숙한 도구 | 샤딩 복잡성 |

### Consequences

#### 긍정적 영향:
- ✅ **데이터 일관성**: 결제 트랜잭션 중 시스템 장애 시에도 데이터 무결성 보장
- ✅ **복잡한 쿼리**: 주문 통계, 매출 분석을 위한 복잡한 JOIN 쿼리 최적화
- ✅ **성숙한 생태계**: pgAdmin, DataGrip 등 풍부한 관리 도구
- ✅ **표준 SQL**: 개발자 친숙도 높고 마이그레이션 용이
- ✅ **동시성 제어**: MVCC를 통한 높은 동시성 처리
- ✅ **JSON 지원**: JSONB를 통한 NoSQL 스타일 데이터 처리 가능

#### 부정적 영향:
- ❌ **수평적 확장**: 샤딩이 복잡하고 자동화 수준 낮음
- ❌ **스키마 변경**: 마이그레이션 계획 및 다운타임 필요
- ❌ **메모리 사용량**: MongoDB 대비 높은 메모리 사용량
- ❌ **초기 설정**: 튜닝과 최적화에 전문 지식 필요

---

## ADR-002: 상품/리뷰 서비스 데이터베이스 선택 - MongoDB

### Status
Accepted (승인됨)

### Context
상품 카탈로그와 리뷰 서비스를 위한 데이터베이스가 필요합니다.

**주요 요구사항:**
- 유연한 상품 스키마 (다양한 카테고리별 속성)
- 중첩된 데이터 구조 (상품 옵션, 이미지, 리뷰)
- 빠른 읽기 성능 (상품 목록, 검색)
- 수평적 확장성 (트래픽 증가 대응)
- 검색 엔진 연동 용이성

### Decision
**MongoDB를 상품 및 리뷰 서비스의 데이터베이스로 선택합니다.**

**Y-Statement:**
"MongoDB를 선택함으로써, 우리는 유연한 스키마와 빠른 읽기 성능을 확보하여 다양한 상품 데이터를 효율적으로 처리하는 대신, 복잡한 관계형 쿼리와 강력한 일관성 보장을 포기하기로 결정했습니다."

### Consequences

#### 긍정적 영향:
- ✅ **스키마 유연성**: 카테고리별 다른 속성 구조 자유롭게 저장
- ✅ **중첩 데이터**: 상품 옵션, 이미지 배열을 자연스럽게 모델링
- ✅ **읽기 성능**: 상품 목록, 상세 조회 최적화
- ✅ **수평 확장**: 샤딩을 통한 자동 확장
- ✅ **개발 속도**: 스키마 변경 시 즉시 반영 가능

#### 부정적 영향:
- ❌ **조인 성능**: 여러 컬렉션 간 조인 쿼리 성능 제한
- ❌ **일관성**: 최종 일관성으로 인한 일시적 불일치 가능
- ❌ **트랜잭션**: 제한적인 트랜잭션 지원

---

## ADR-003: 세션 스토리지 선택 - Redis

### Status
Accepted (승인됨)

### Context
사용자 세션, 장바구니, 임시 데이터 저장을 위한 캐시/세션 스토리지가 필요합니다.

**주요 요구사항:**
- 빠른 읽기/쓰기 성능
- TTL 기반 자동 만료
- 세션 공유 (여러 인스턴스)
- 장바구니 임시 저장

### Decision
**Redis를 세션 스토리지 및 캐시로 선택합니다.**

**Y-Statement:**
"Redis를 선택함으로써, 우리는 메모리 기반의 극강 성능과 다양한 데이터 구조 지원을 확보하는 대신, 메모리 의존성과 영속성 제한을 감수하기로 결정했습니다."

### Consequences

#### 긍정적 영향:
- ✅ **고성능**: 메모리 기반으로 매우 빠른 응답속도
- ✅ **다양한 자료구조**: String, Hash, List, Set, Sorted Set 지원
- ✅ **TTL 지원**: 세션 만료, 캐시 무효화 자동 처리
- ✅ **클러스터링**: Redis Cluster를 통한 고가용성

#### 부정적 영향:
- ❌ **메모리 의존**: 메모리 크기 제한, 비용 상승
- ❌ **영속성**: 기본적으로 휘발성, 백업 설정 필요

---

## ADR-004: 메시지 큐 선택 - RabbitMQ

### Status
Accepted (승인됨)

### Context
마이크로서비스 간 비동기 통신을 위한 메시지 큐 시스템이 필요합니다.

**주요 사용 사례:**
- 주문 생성 → 결제 처리 알림
- 결제 완료 → 배송 준비 알림  
- 시스템 이벤트 → 이메일/SMS 발송

### Decision
**RabbitMQ를 메시지 큐로 선택합니다.**

**Y-Statement:**
"RabbitMQ를 선택함으로써, 우리는 안정적인 메시지 전달 보장과 유연한 라우팅 패턴을 확보하는 대신, 높은 처리량이 필요한 빅데이터 스트리밍에서의 성능 제한을 감수하기로 결정했습니다."

### Consequences

#### 긍정적 영역:
- ✅ **메시지 보장**: At-least-once delivery 지원
- ✅ **유연한 라우팅**: Exchange, Queue, Binding을 통한 복잡한 라우팅
- ✅ **관리 도구**: 웹 기반 관리 인터페이스 제공
- ✅ **다양한 프로토콜**: AMQP, MQTT, STOMP 지원

#### 부정적 영향:
- ❌ **처리량**: Kafka 대비 상대적으로 낮은 처리량
- ❌ **메모리 사용량**: 메시지 저장을 위한 메모리 사용

---

## 종합 데이터 아키텍처 결정 요약

### 선택된 기술 스택
```
┌─────────────────┬──────────────┬─────────────────┐
│ 서비스          │ 데이터베이스  │ 선택 근거        │
├─────────────────┼──────────────┼─────────────────┤
│ 사용자 인증      │ PostgreSQL   │ ACID, 관계형    │
│ 주문 처리       │ PostgreSQL   │ 트랜잭션, 일관성 │
│ 결제 처리       │ PostgreSQL   │ 금융 데이터     │
│ 배송 추적       │ PostgreSQL   │ 상태 관리       │
│ 상품 카탈로그    │ MongoDB      │ 유연한 스키마   │
│ 리뷰 시스템     │ MongoDB      │ 중첩 데이터     │
│ 장바구니        │ Redis        │ 세션, 캐시      │
│ 메시지 큐       │ RabbitMQ     │ 비동기 통신     │
└─────────────────┴──────────────┴─────────────────┘
```

### 향후 고려사항
- **확장성**: PostgreSQL 서비스는 Read Replica를 통한 읽기 성능 향상
- **모니터링**: 각 데이터베이스별 성능 메트릭 수집 및 알림 설정
- **백업**: 정기적인 백업 전략 수립 (PostgreSQL: pg_dump, MongoDB: mongodump)
- **보안**: 각 데이터베이스별 접근 제어 및 암호화 설정
