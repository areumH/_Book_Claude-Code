# 온라인 쇼핑몰 마이크로서비스 기술 리스크 데이터베이스

## 개요
본 문서는 온라인 쇼핑몰 마이크로서비스 아키텍처의 구체적인 기술 리스크를 체계적으로 분석한 데이터베이스입니다.

---

## 기술적 리스크 분석

### 🔴 높은 위험도

#### 1. 데이터베이스 병목 현상
- **리스크**: 단일 PostgreSQL 인스턴스가 10,000명 동시 접속 처리 불가
- **발생 확률**: 높음 (85%)
- **영향도**: 치명적
- **예상 손실**: 시간당 $50,000 매출 손실, 고객 이탈률 30% 증가
- **대응 방안**:
  - Read Replica 구성 (Master-Slave 아키텍처)
  - Connection Pooling (PgBouncer) 도입
  - 데이터베이스 파티셔닝 고려
  - 샤딩 전략 수립 (사용자 ID 기반)
  - AWS RDS Multi-AZ 배포
- **모니터링 지표**: Connection Pool 사용률, DB CPU 사용률, 쿼리 응답시간
- **임계값**: 동시 접속 > 1000, CPU > 80%, 응답시간 > 500ms

#### 2. 마이크로서비스 간 통신 지연
- **리스크**: 서비스 간 동기식 HTTP 통신으로 인한 지연 누적
- **발생 확률**: 중간 (65%)
- **영향도**: 높음
- **예상 손실**: API 응답시간 3초 이상 시 전환율 50% 하락
- **대응 방안**:
  - 비동기 메시징 (RabbitMQ/Kafka) 도입
  - Circuit Breaker 패턴 구현 (Hystrix)
  - Service Mesh (Istio) 고려
  - API Gateway에서 Request/Response 캐싱
  - Timeout 및 Retry 정책 수립
- **모니터링 지표**: API 응답시간, 에러율, Throughput
- **임계값**: 응답시간 > 2초, 에러율 > 5%, Throughput < 100 RPS

#### 3. 단일 API Gateway 장애점
- **리스크**: API Gateway 장애 시 전체 시스템 접근 불가
- **발생 확률**: 중간 (45%)
- **영향도**: 치명적
- **예상 손실**: 전체 서비스 중단, 시간당 $100,000 손실
- **대응 방안**:
  - API Gateway HA 구성 (로드밸런서 + 다중 인스턴스)
  - Health Check 및 자동 Failover
  - Circuit Breaker 패턴으로 서비스 격리
  - Rate Limiting 및 DDoS 보호
  - 백업 엔트리포인트 구성
- **모니터링 지표**: Gateway 가용성, 처리량, 응답시간
- **임계값**: 가용성 < 99.9%, 처리량 < 1000 RPS, 응답시간 > 100ms

#### 4. 분산 트랜잭션 실패
- **리스크**: 주문-결제-재고 간 데이터 불일치로 비즈니스 로직 오류
- **발생 확률**: 높음 (75%)
- **영향도**: 치명적
- **예상 손실**: 중복 주문, 재고 부족, 고객 클레임 증가
- **대응 방안**:
  - Saga Pattern 구현 (Choreography 방식)
  - 보상 트랜잭션 (Compensating Transaction)
  - 이벤트 소싱 패턴 도입
  - Idempotent 연산 보장
  - 분산 락 메커니즘 (Redis Lock)
- **모니터링 지표**: 트랜잭션 성공률, 롤백 횟수, 데이터 일관성
- **임계값**: 성공률 < 98%, 롤백 > 5%, 불일치 건수 > 10건/일

#### 5. Docker 컨테이너 리소스 한계
- **리스크**: 트래픽 급증 시 컨테이너 메모리/CPU 부족으로 서비스 중단
- **발생 확률**: 높음 (70%)
- **영향도**: 높음
- **예상 손실**: 서비스 품질 저하, 응답시간 10배 증가
- **대응 방안**:
  - Kubernetes HPA (Horizontal Pod Autoscaler) 구성
  - 리소스 제한 및 요청 값 최적화
  - 메모리 누수 모니터링 및 방지
  - JVM Heap 크기 튜닝
  - 컨테이너 이미지 경량화
- **모니터링 지표**: CPU/Memory 사용률, Pod 개수, 응답시간
- **임계값**: CPU > 80%, Memory > 85%, 응답시간 > 1초

### 🟡 중간 위험도

#### 6. 캐시 무효화 전략 부재
- **리스크**: Redis 캐시 일관성 문제로 잘못된 데이터 제공
- **발생 확률**: 중간 (55%)
- **영향도**: 중간
- **예상 손실**: 고객 불만, 브랜드 신뢰도 하락
- **대응 방안**:
  - Cache-Aside 패턴 구현
  - TTL 기반 캐시 만료 정책
  - 이벤트 기반 캐시 무효화
  - Write-Through/Write-Behind 전략
  - 캐시 워밍업 전략
- **모니터링 지표**: Cache Hit Rate, 캐시 크기, 무효화 빈도
- **임계값**: Hit Rate < 80%, 크기 > 90%, 무효화 > 100건/분

#### 7. 서비스 디스커버리 장애
- **리스크**: 서비스 인스턴스 변경 시 연결 실패
- **발생 확률**: 중간 (40%)
- **영향도**: 중간
- **예상 손실**: 일부 기능 이용 불가, 사용자 경험 저하
- **대응 방안**:
  - Consul/Eureka 기반 서비스 레지스트리
  - Health Check 및 자동 제거
  - Client-side Load Balancing
  - DNS 기반 서비스 발견
  - Graceful Shutdown 구현
- **모니터링 지표**: 등록된 서비스 수, Health Check 성공률
- **임계값**: 서비스 수 변동 > 20%, Health Check < 95%

#### 8. 메시지 큐 처리 지연
- **리스크**: RabbitMQ 메시지 적체로 비동기 처리 지연
- **발생 확률**: 중간 (50%)
- **영향도**: 중간
- **예상 손실**: 알림 지연, 재고 업데이트 지연
- **대응 방안**:
  - Queue 모니터링 및 알람 설정
  - Consumer 스케일링 자동화
  - Dead Letter Queue 구성
  - 메시지 우선순위 설정
  - Batch 처리 최적화
- **모니터링 지표**: Queue 크기, 처리 시간, Consumer 수
- **임계값**: Queue > 1000건, 처리시간 > 30초, Consumer < 3개

#### 9. TypeScript 컴파일 오류
- **리스크**: Strict 모드에서 런타임 오류 증가
- **발생 확률**: 중간 (45%)
- **영향도**: 중간
- **예상 손실**: 개발 생산성 20% 저하, 배포 지연
- **대응 방안**:
  - 점진적 타입 도입 전략
  - ESLint 규칙 커스터마이징
  - 타입 가드 함수 구현
  - 코드 리뷰 체크리스트
  - 자동 타입 생성 도구
- **모니터링 지표**: 컴파일 오류 수, 빌드 시간, 타입 커버리지
- **임계값**: 오류 > 50건, 빌드시간 > 5분, 커버리지 < 80%

#### 10. 로그 저장 공간 부족
- **리스크**: 로그 적재량 급증으로 디스크 용량 초과
- **발생 확률**: 중간 (60%)
- **영향도**: 중간
- **예상 손실**: 로그 유실, 장애 분석 불가
- **대응 방안**:
  - 로그 로테이션 정책 수립
  - ELK Stack 기반 중앙 로깅
  - 로그 레벨별 필터링
  - 압축 및 아카이빙
  - 디스크 사용량 모니터링
- **모니터링 지표**: 디스크 사용률, 로그 크기, 보존 기간
- **임계값**: 사용률 > 85%, 로그 > 10GB/일, 보존 < 7일

### 🟢 낮은 위험도

#### 11. 개발 환경 불일치
- **리스크**: Local/Dev/Prod 환경 차이로 배포 후 오류
- **발생 확률**: 낮음 (25%)
- **영향도**: 낮음
- **예상 손실**: 핫픽스 배포, 개발자 야근
- **대응 방안**:
  - Docker 기반 환경 일관성
  - 환경변수 중앙 관리
  - Infrastructure as Code
  - 배포 전 스모크 테스트
  - Feature Flag 활용
- **모니터링 지표**: 환경별 설정 차이, 배포 성공률
- **임계값**: 설정 차이 > 5개, 성공률 < 95%

#### 12. 의존성 라이브러리 취약점
- **리스크**: npm 패키지의 보안 취약점 노출
- **발생 확률**: 낮음 (30%)
- **영향도**: 중간
- **예상 손실**: 보안 패치 비용, 잠재적 데이터 유출 위험
- **대응 방안**:
  - 정기적인 `npm audit` 실행
  - Dependabot 자동 업데이트
  - 취약점 스캔 자동화
  - 패키지 화이트리스트 관리
  - SBOM (Software Bill of Materials) 생성
- **모니터링 지표**: 취약점 개수, 패치 적용률, 스캔 빈도
- **임계값**: 취약점 > 10개, 패치율 < 90%, 스캔 < 주 1회

---

## 리스크 대응 우선순위 매트릭스

| 순위 | 리스크 ID | 리스크 명 | 확률×영향 | 대응 기한 | 담당자 |
|------|-----------|-----------|-----------|-----------|--------|
| 1 | R01 | 데이터베이스 병목 현상 | 85×5 = 425 | 2주 | DB팀 |
| 2 | R04 | 분산 트랜잭션 실패 | 75×5 = 375 | 3주 | Backend팀 |
| 3 | R05 | 컨테이너 리소스 한계 | 70×4 = 280 | 2주 | DevOps팀 |
| 4 | R02 | 서비스 간 통신 지연 | 65×4 = 260 | 4주 | Backend팀 |
| 5 | R03 | API Gateway 장애점 | 45×5 = 225 | 3주 | 인프라팀 |
| 6 | R06 | 캐시 무효화 전략 | 55×3 = 165 | 4주 | Backend팀 |
| 7 | R10 | 로그 저장 공간 부족 | 60×2 = 120 | 6주 | DevOps팀 |
| 8 | R08 | 메시지 큐 처리 지연 | 50×3 = 150 | 5주 | Backend팀 |

---

## 월별 리스크 관리 계획

### Month 1: 긴급 대응
- **R01**: PostgreSQL Read Replica 구성
- **R05**: Kubernetes HPA 설정
- **R04**: Saga Pattern 설계 및 구현 시작

### Month 2: 핵심 인프라 안정화
- **R02**: Circuit Breaker 패턴 구현
- **R03**: API Gateway HA 구성
- **R06**: Redis 캐시 전략 수립

### Month 3: 모니터링 및 최적화
- **R08**: RabbitMQ 모니터링 강화
- **R10**: 중앙 로깅 시스템 구축
- **R07**: 서비스 디스커버리 안정화

### Month 4: 보안 및 품질
- **R09**: TypeScript 품질 개선
- **R11**: 환경 일관성 확보
- **R12**: 보안 취약점 스캔 자동화

---

## 리스크 모니터링 대시보드

### 실시간 모니터링 지표
```yaml
데이터베이스:
  - PostgreSQL 동시 연결 수
  - 쿼리 응답 시간 (P95)
  - CPU/Memory 사용률

서비스 통신:
  - API 응답 시간 분포
  - 에러율 (4xx/5xx)
  - Circuit Breaker 상태

인프라:
  - 컨테이너 리소스 사용률
  - Queue 적체량
  - 캐시 히트율
```

### 주간 리포트 항목
- 리스크별 발생 횟수 및 영향도
- 대응 조치 완료 현황
- 새로 식별된 리스크
- SLA 달성률 및 개선사항

---

## 비상 대응 절차

### 🚨 Critical (P0) - 즉시 대응
1. **데이터베이스 과부하 (R01)**
   - 즉시 Read-Only 모드 전환
   - 트래픽 쉐딩 (특정 기능 비활성화)
   - 긴급 스케일 아웃

2. **전체 서비스 다운 (R03)**
   - API Gateway 백업 인스턴스 활성화
   - DNS 전환 (Failover)
   - 고객 공지 및 상황 업데이트

### 🔥 High (P1) - 1시간 이내
- 분산 트랜잭션 실패 시 수동 보상 트랜잭션 실행
- 컨테이너 리소스 한계 시 긴급 스케일링
- 서비스 통신 지연 시 Circuit Breaker 강제 개방

### ⚠️ Medium (P2) - 4시간 이내
- 캐시 일관성 문제 시 전체 캐시 무효화
- 메시지 큐 적체 시 Consumer 수동 증설
- 로그 공간 부족 시 긴급 정리

이 리스크 데이터베이스를 바탕으로 프로젝트 전반에 걸친 체계적인 위험 관리와 신속한 대응이 가능할 것입니다.